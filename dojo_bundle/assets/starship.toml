# ~/.config/starship.toml
add_newline = true
command_timeout = 3000

format = """
üßë‚Äçüíª $username$hostname  üß≠ $directory
${custom.git}
${custom.buildroot}
üß† $memory_usage  üåê ${custom.net}
$character
"""

# ---------------- Identity ----------------
[username]
show_always = true
format = "$user"

[hostname]
ssh_only = false
format = "@$hostname "

[directory]
truncate_to_repo = false
truncation_length = 0
format = "$path "

# ---------------- Git (only in repos) ----------------
[custom.git]
when = "git rev-parse --is-inside-work-tree >/dev/null 2>&1"
command = """
b=$(git rev-parse --abbrev-ref HEAD 2>/dev/null) || exit 0
c=$(git status --porcelain 2>/dev/null | wc -l)
if [ "$c" -eq 0 ]; then
  echo "Ôêà $b"
else
  echo "Ôêà $b ‚úèÔ∏è$c"
fi
"""
format = "$output"

# ---------------- Buildroot (only when BR2_ vars exist) ----------------
[custom.buildroot]
when = "env | grep -q '^BR2_'"
command = """
out=""
[ -n "$BR2_EXTERNAL" ] && out="$out ext=$BR2_EXTERNAL"
[ -n "$BR2_OUTPUT_DIR" ] && out="$out O=$BR2_OUTPUT_DIR"
[ -n "$BR2_DEFCONFIG" ] && out="$out def=$BR2_DEFCONFIG"
[ -n "$CROSS_COMPILE" ] && out="$out cc=$CROSS_COMPILE"
[ -n "$out" ] && echo "üß±$out"
"""
format = "$output"

# ---------------- Memory ----------------
[memory_usage]
disabled = false
threshold = 1
symbol = ""
format = "$ram "

# ---------------- Network (ignore loopback) ----------------
[custom.net]
when = "ip -o -4 addr show up | grep -vq '^.* lo '"
command = "ip -o -4 addr show up | awk '{print $2, $4}' | sed 's#/.*##' | grep -v '^lo ' | head -n1"
format = "$output"

# ---------------- Prompt (escape $) ----------------
[character]
success_symbol = "\\$ "
error_symbol = "‚úñ ERROR \\$ "
vimcmd_symbol = "‚Ü∫ "
